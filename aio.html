<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Getting Started With Neuroimaging Analysis: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav IDEAS"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="IDEAS" src="assets/images/IDEAS-logo.svg"><abbr class="badge badge-light" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="background-color: #FF4955; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #000">
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
            Pre-Alpha
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav IDEAS" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="IDEAS" src="assets/images/IDEAS-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Getting Started With Neuroimaging Analysis
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Getting Started With Neuroimaging Analysis
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Getting Started With Neuroimaging Analysis
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress IDEAS">
    <div class="progress-bar IDEAS" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="imaging-data-structure-and-formats.html">1. Imaging Data: Structure And Formats</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="structural-mri.html">2. Structural MRI: Bias Correction, Segmentation and Image Registration</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-imaging-data-structure-and-formats"><p>Content from <a href="imaging-data-structure-and-formats.html">Imaging Data: Structure And Formats</a></p>
<hr>
<p>Last updated on 2024-06-05 |
        
        <a href="https://github.com/HealthBioscienceIDEAS/aaic2024-neuroimaging-workshop/edit/main/episodes/imaging-data-structure-and-formats.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How is imaging data represented in a computer?</li>
<li>What are some of the popular imaging formats used?</li>
<li>How do I view and navigate around an image/</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Describe the structure of imaging data</li>
<li>Understand the coordinate systems and mapping between voxels and
real world.</li>
<li>Demonstrate how to view images, navigate through volumes and change
contrast</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="introduction"><h2 class="section-heading">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>Any medical image consists of two parts: a <strong>header</strong>
and the <strong>image</strong> itself. The header consists of metadata
that describe the image. This includes the patient’s demographic
information such as the patient’s name, age, gender, and date of birth.
The header also gives information on the image characteristics such as
image dimension and some acquisition parameters. Because of the need to
store more information, medical images require specific formats
(different from e.g. .jpeg or .png).</p>
<div class="section level3">
<h3 id="image-formats-dicom-and-nifti">Image formats: DICOM and NIfTI<a class="anchor" aria-label="anchor" href="#image-formats-dicom-and-nifti"></a>
</h3>
<p><strong>DICOM (.dcm)</strong> stands for Digital Imaging and
Communications in Medicine. It is a standard, internationally accepted
format to view, store, retrieve and share medical images. Clinical
imaging data are typically stored and transferred in the DICOM format,
so DICOM can be considered the native format in which we get imaging
data from the scanner.</p>
<p><strong>NIfTI (.nii, .nii.gz)</strong> format is simpler and easier
to support, so has been widely adopted by scientists in the neuroimaging
community. Therefore, a vital initial step in processing the data is to
convert images from DICOM to NIfTI format. In this practical we will
work with data that have already been converted to NIfTI, but many tools
for such conversions are available (for example <a href="https://www.nitrc.org/plugins/mwiki/index.php/dcm2nii:MainPage" class="external-link">dcm2niix</a>).</p>
</div>
<div class="section level3">
<h3 id="viewing-image-properties---fslhd-and-fslinfo">Viewing image properties - fslhd and fslinfo<a class="anchor" aria-label="anchor" href="#viewing-image-properties---fslhd-and-fslinfo"></a>
</h3>
<p>These tools enable various properties of an image to be viewed.</p>
<p>Clicking on the Applications in the upper left-hand corner and select
the terminal icon. This will open a terminal window that you will use to
type commands <img src="fig/aic_smri_launch_terminal.png" alt="Launch terminal window" class="figure"></p>
<p>From the terminal window type:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="bu">cd</span> ~/data/ImageDataVisualization</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">ls</span></span></code></pre>
</div>
<p>This means that we are going to be working in the
<code>ImageDataVisualization</code> subfolder under <code>data</code> in
your home directory (<code>~</code>). The <code>ls</code> command gives
you a list of the files in this directory.</p>
<p>Type</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">fslhd</span> sub-OAS30015_T1w.nii.gz</span></code></pre>
</div>
<p>TODO: Add output and</p>
<pre class="shell"><code>fslhd sub-OAS30015_T1w_brain_pve_0.nii.gz</code></pre>
<p>TODO: Add output and let’s look at the most important fields:</p>
<ul>
<li>
<strong>Data type</strong> (<code>data_type</code>): Note that some
images (<code>sub-OAS30015_T1w</code>) are of <em>integer</em> datatype,
while others (<code>sub-OAS30015_T1w_brain_pve_0</code>) are of
<em>floating point</em> datatype. Integer means that the intensity
values can only take on whole numbers - no fractions - raw image data is
normally of this type. Floating point means that intensity values can be
fractional - the result of applying most statistical processing
algorithms to image data results in images of floating point type.</li>
<li>
<strong>Image dimension</strong> (<code>dim1</code>,
<code>dim2</code>,<code>dim3</code>): this is the number of voxels in
the image in the x,y,z dimension. This means that we have a cube of
imaging data in the file that contains <code>dim1</code> columns,
<code>dim2</code> rows, and <code>dim3</code> slices.</li>
<li>
<strong>Image resolution (Voxel size)</strong>
(<code>pixdim1</code>,<code>pixdim2</code>,<code>pixdim3</code>) : this
tells us the size that each voxel represents (in mm) in the x,y,z
dimension.</li>
</ul>
<p><em>As an example to understand the difference between image
dimension and image resolution, an MRI of a fruit fly or an elephant
could contain 256 slices (same <code>dim3</code> value), but one image
would have to represent a much larger size in the real world than the
other (different <code>pixdim3</code>).</em></p>

<ul>
<li>
<strong>Affine transformation</strong> (<code>qform</code>): this
field encodes a transformation or mapping that tells us <strong>how to
convert the voxel location (i,j,k) to the real-world coordinates
(x,y,z)</strong> (i.e. the coordinate system of the MRI scanner in which
the image was acquired). The real-world coordinate system tends to be
defined according to the patient. The x-axis tends to go from patient
left to patient right, the y axis tends to go from anterior to
posterior, and the z-axis goes from top to bottom of the patient. This
mapping is very important, as this information will be needed to
correctly visualize images and also to align them later. <img src="fig/coordinates_affine.png" alt="Display toolbar" class="figure"> An alternative
command to <code>fslinfo</code> is <code>fslhd</code>, which displays a
reduced set of properties about the images (mainly data type, dimension
and resolution).</li>
</ul>
</div>
</section><section id="neuroimaging-data-analysis"><h2 class="section-heading">Neuroimaging data analysis<a class="anchor" aria-label="anchor" href="#neuroimaging-data-analysis"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="generic-blueprint-of-a-neuroimaging-study">Generic blueprint of a neuroimaging study<a class="anchor" aria-label="anchor" href="#generic-blueprint-of-a-neuroimaging-study"></a>
</h3>
<p>The steps to conduct a neuroimaging study are very similar to any
other scientific experiment. As we go through the workshop today, think
about where a certain analysis or tool falls in this generic
pipeline:</p>
<table class="table">
<colgroup>
<col width="16%">
<col width="33%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Step</th>
<th>Aim</th>
<th>Challenges and considerations</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>1. Data Acquisition</strong></td>
<td>Obtain good quality and consistent data</td>
<td>Trade offs often necessary (e.g. time vs resolution). Optimize
protocol for your research aim. We will use already acquired data from
OASIS.</td>
</tr>
<tr class="even">
<td><strong>2. Data preprocessing</strong></td>
<td>Reduce noise and prepare data for further analysis</td>
<td>Some steps are common across modalities (e.g. brain extraction,
registration), others are modality-specific (e.g. motion correction,
distortion correction). Requires careful checking.</td>
</tr>
<tr class="odd">
<td><strong>3. Single-subject analysis</strong></td>
<td>Obtain measure of interest for each subject (often an image)</td>
<td>Modality-specific. Examples of single-subject outputs are
tissue-type segmentation maps, fractional anisotropy map.</td>
</tr>
<tr class="even">
<td><strong>4. Group-level analysis</strong></td>
<td>Compare single-subject results across groups</td>
<td>Common step across modalities. Usually happens in standard space
(i.e. after images from all subjects have been aligned to a reference
image, called <em>template</em>).</td>
</tr>
<tr class="odd">
<td><strong>5. Statistical inference</strong></td>
<td>Test reliability of results and generalizability to the
population</td>
<td>Common across modalities.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="neuroimaging-data-organization---brain-imaging-data-structure-bids">Neuroimaging data organization - Brain Imaging Data Structure
(BIDS)<a class="anchor" aria-label="anchor" href="#neuroimaging-data-organization---brain-imaging-data-structure-bids"></a>
</h3>
<p>Neuroimaging experiments usually generate multiple images and
non-imaging data. This can result in complicated data that can be
arranged in many different ways. Despite the structure of a neuroimaging
study is fairly standard, so far there is no consensus on how to
organize and share data obtained in neuroimaging experiments. The <a href="https://bids.neuroimaging.io/get_started.html" class="external-link">Brain Imaging Data
Structure (BIDS)</a> is a framework for organizing data in a
standardized way.</p>
<p>The main specifications regard how to structure data/metadata within
a hierarchy of folders and how to name files. The data you will use in
this workshop will mostly be organized according to this standard. If
you are interested, you can find the details of these specifications in
the <a href="https://bids-standard.github.io/bids-starter-kit/index.html" class="external-link">BIDS
starter kit</a>.</p>
</div>
</section><section id="visualizing-neuroimaging-data---fsleyes"><h2 class="section-heading">Visualizing neuroimaging data - FSLeyes<a class="anchor" aria-label="anchor" href="#visualizing-neuroimaging-data---fsleyes"></a>
</h2>
<hr class="half-width">
<p>FSLeyes (pronounced <strong>fossilize</strong>) is the FSL image
viewer for 3D and 4D data. It does not perform any processing or
analysis of images - that is done by separate tools. FSLeyes has lots of
features to visualize data and results in a variety of useful ways, and
some of these are shown in this introductory practical.</p>
<p>Here we provide a quick introduction to some FSLeyes features that
you will be likely to use throughout the workshop, while other more
specific features will be introduced at a later point. If you are
already familiar with FSLeyes, feel free to skip this part and move on
to another section of the workshop.</p>
<p>For a full overview of what FSLeyes can do, take a look at the <a href="https://open.win.ox.ac.uk/pages/fsl/fsleyes/fsleyes/userdoc/index.html" class="external-link">FSLeyes
user guide</a>.</p>
<div class="section level3">
<h3 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h3>
<p>Assuming you are still in the
<code>~/data/ImageDataVisualization</code> directory,</p>
<p>Start FSLeyes by typing in the terminal:</p>
<pre class="shell"><code>fsleyes &amp;</code></pre>
<p>The <code>&amp;</code> means that the program you asked for
(<code>fsleyes</code>) runs in the background in the terminal (or
shell), and you can keep typing and running other commands while fsleyes
continues to run. If you had not made <code>fsleyes</code> run in the
background (i.e., if you had just typed <code>fsleyes</code> without the
<code>&amp;</code> at the end) then you would not be able to get
anything to run in that terminal until you killed <code>fsleyes</code>
(although you could still type things, but they would not run).</p>
</div>
<div class="section level3">
<h3 id="basic-image-viewing">Basic image viewing<a class="anchor" aria-label="anchor" href="#basic-image-viewing"></a>
</h3>
<p>FSLeyes by defaults opens in the <em>ortho view</em> mode. If you add
image filenames on the command line (after typing <code>fsleyes</code>)
it will load them all automatically, and you can also add many options
from the command line. FSLeyes assumes that all of the images which you
load share a single coordinate system, but images do not have to have
the same field of view, number of voxels, or timepoints.</p>
<p>In FSLeyes, load in the image <code>sub-OAS30015_T1w.nii.gz</code>,
by pressing <em>File &gt; Add from file</em> and selecting the image.
This image is a structural MRI T1-weighted scan.</p>
<p>Hold the mouse button down in one of the ortho canvases and move it
around - see how various things update as you do so:</p>
<ul>
<li>the other canvases update their view</li>
<li>the cursor’s position in both voxel and mm co-ordinates gets
updated</li>
<li>the image intensity at the cursor is shown</li>
</ul>
</div>
<div class="section level3">
<h3 id="navigating-in-an-ortho-view">Navigating in an ortho view<a class="anchor" aria-label="anchor" href="#navigating-in-an-ortho-view"></a>
</h3>
<p>You can interact with an orthographic view in a number of ways. Spend
a couple of minutes trying each of these.</p>
<ul>
<li>Click, or click and drag on a canvas, to change the current
location.</li>
<li>Right click and drag on a canvas to draw a zoom rectangle. When you
release the mouse, the canvas will zoom in to that rectangle.</li>
<li>Hold down the ⌘ key (OSX) or CTRL key (Linux), and use your mouse
wheel to zoom in and out of a canvas.</li>
<li>Hold down the ⇧ key, and use your mouse wheel to change the current
location along the depth axis (change the displayed slice) for that
canvas.</li>
<li>You can middle-click and drag, or hold down the ALT key and drag
with the left mouse button, to pan around.</li>
</ul>
</div>
<div class="section level3">
<h3 id="the-display-toolbar">The display toolbar<a class="anchor" aria-label="anchor" href="#the-display-toolbar"></a>
</h3>
<p><img src="fig/display_toolbar.png" alt="Display toolbar" height="180" class="figure"> The display toolbar allows you to adjust the display
properties of the currently selected image. Play around with the
controls and note how the image display changes (but leave the “overlay
type” as “3D/4D volume”).</p>
<p>The word “overlay” is interchangeable with “image”. FSLeyes uses
“overlay” because it can also load some other non-image file types such
as surface images.</p>
<ol style="list-style-type: decimal">
<li>
<strong>Overlay display panel:</strong> Clicking on the gear button
( <img src="fig/gear_icon.png" alt="gear icon" height="24" class="figure"> ) opens a
panel with more display settings.</li>
<li>
<strong>Overlay information:</strong> Clicking on the information
button ( <img src="fig/information_icon.png" alt="info" height="24" class="figure"> )
opens a panel with information about the image.</li>
<li>
<strong>Overlay name:</strong> You can change the image name here
(for display purpose only, it will not change the actual filename).</li>
<li>
<strong>Overlay type:</strong> FSLeyes allows some images to be
displayed in different ways. This should be set to “3D/4D volume” most
of the time.</li>
<li>
<strong>Opacity:</strong> Adjust the opacity (transparency)
here.</li>
<li>
<strong>Brightness/contrast:</strong> Quickly adjust the image
brightness and contrast here.</li>
<li>
<strong>Display range:</strong> Use these fields for fine-grained
control over how the image data is coloured, instead of using the
brightness and contrast sliders.</li>
<li>
<strong>Colour map:</strong> Choose from several different colour
maps.</li>
<li>
<strong>Enable -ve colour map:</strong> If you are viewing an image
that has both positive and negative values, this button allows you to
enable a colour map that is used for the negative values.</li>
<li>
<strong>-ve colour map:</strong> Choose a colour map for negative
values here.</li>
</ol>
<p>If FSLeyes does not have enough room to display a toolbar in full, it
will display left and right arrows ( <img src="fig/toolbar_left.png" alt="left" height="24" class="figure"> ), ( <img src="fig/toolbar_right.png" alt="right" height="24" class="figure"> ) on each side of the toolbar - you can click
on these arrows to navigate back and forth through the toolbar.</p>
</div>
<div class="section level3">
<h3 id="the-ortho-toolbar">The ortho toolbar<a class="anchor" aria-label="anchor" href="#the-ortho-toolbar"></a>
</h3>
<figure><img src="fig/ortho_toolbar.png" alt="Ortho toolbar" height="160" class="figure mx-auto d-block"></figure><p>The ortho toolbar allows you to adjust and control the ortho view.
Play with the controls, and try to figure out what each of them do.</p>
<ol style="list-style-type: decimal">
<li>
<strong>View settings panel</strong> <img src="fig/spanner_icon.png" alt="spanner icon" height="24" class="figure"> : Clicking on the spanner button opens
panel with advanced ortho view settings.</li>
<li>
<strong>Screenshot</strong> <img src="fig/camera_icon.png" alt="screenshot icon" height="24" class="figure"> : Clicking on the camera button
will allow you to save the current scene, in this ortho view, to an
image file.</li>
<li>
<strong>Toggle canvases</strong> <img src="fig/sagittal_icon.png" alt="sagittal icon" height="24" class="figure"> , <img src="fig/coronal_icon.png" alt="coronal icon" height="24" class="figure"> , <img src="fig/axial_icon.png" alt="axial icon" height="24" class="figure"> : These three buttons allow you to
toggle each of the three canvases on the ortho view.</li>
<li>
<strong>Canvas layout</strong> <img src="fig/horizontal_icon.png" alt="horizontal icon" height="24" class="figure"> , <img src="fig/vertical_icon.png" alt="vertical icon" height="24" class="figure"> , <img src="fig/grid_icon.png" alt="grid icon" height="24" class="figure"> : These three buttons allow you to choose
between laying out the canvases horizontally (<img src="fig/horizontal_icon.png" alt="horizontal icon" height="24" class="figure"> ),
vertically (<img src="fig/vertical_icon.png" alt="vertical icon" height="24" class="figure"> ), or in a grid (<img src="fig/grid_icon.png" alt="grid icon" height="24" class="figure"> ).</li>
<li>
<strong>Movie mode</strong> <img src="fig/movie_icon.png" alt="movie icon" height="24" class="figure"> : This button enables <em>movie
mode</em> - if you load a 4D image, and turn on movie mode, the image
will be “played” as a movie (the view will loop through each of the 3D
images in the 4D volume).</li>
<li>
<strong>Toggle cursor/labels</strong> <img src="fig/plus_icon.png" alt="add icon" height="24" class="figure"> : This button allows you to toggle the
anatomical labels and location cursor on and off.</li>
<li>
<strong>Reset zoom</strong> <img src="fig/reset_zoom_icon.png" alt="add icon" height="24" class="figure"> : This button resets the zoom level to
100% on all three canvases.</li>
<li>
<strong>Zoom slider:</strong> Change the zoom level on all three
canvases with this slider.</li>
</ol>
</div>
<div class="section level3">
<h3 id="multiple-views-lightbox">Multiple views: lightbox<a class="anchor" aria-label="anchor" href="#multiple-views-lightbox"></a>
</h3>
<p>Open a <em>lightbox</em> view using <em>View &gt; Lightbox View</em>.
If you drag the mouse around in the viewer you can see that the cursor
position is linked in the two views of the data (the ortho and the
lightbox views). This is particularly useful when you have several
images loaded in at the same time (you can view each in a separate view
window and move around all of them simultaneously). <img src="fig/lightbox_toolbar.png" alt="Lightbox toolbar" height="210" class="figure"></p>
<p>The lightbox view has a slightly different toolbar to the ortho
toolbar.</p>
<ol style="list-style-type: decimal">
<li>
<strong>View settings panel</strong> <img src="fig/spanner_icon.png" alt="spanner icon" height="24" class="figure"> : Clicking on the spanner button opens
a panel with advanced lightbox view settings.</li>
<li>
<strong>Screenshot</strong> <img src="fig/camera_icon.png" alt="screenshot icon" height="24" class="figure"> : Clicking on the camera button
will allow you to save the current scene, in this lightbox view, to an
image file.</li>
<li>
<strong>Z axis</strong> <img src="fig/sagittal_icon.png" alt="sagittal icon" height="24" class="figure"> , <img src="fig/coronal_icon.png" alt="coronal icon" height="24" class="figure"> , <img src="fig/axial_icon.png" alt="axial icon" height="24" class="figure"> : These three buttons allow you to
choose which slice plane to display in the lightbox view.</li>
<li>
<strong>Movie mode</strong> <img src="fig/movie_icon.png" alt="movie icon" height="24" class="figure"> : This button enables movie mode.</li>
<li>
<strong>Slice range:</strong> These sliders allow you to control the
beginning and end points of the slices that are displayed.</li>
<li>
<strong>Zoom:</strong> This slicer allows you to control how many
slices are displayed on the lightbox view.</li>
<li>
<strong>Slice spacing:</strong> This slider allows you to control
the spacing between consecutive slices.</li>
</ol>
</div>
<div class="section level3">
<h3 id="unlinking-cursors">Unlinking cursors<a class="anchor" aria-label="anchor" href="#unlinking-cursors"></a>
</h3>
<p>You can “unlink” the cursor position between the two views (it is
linked by default). Go into one of the views, e.g., the lightbox view,
and press the spanner button ( <img src="fig/spanner_icon.png" alt="spanner icon" height="24" class="figure"> ). This will open the lightbox view
settings panel. Turn off the <strong>Link Location</strong> option, and
close the view settings panel. You will now find that this view (the
lightbox view) is no longer linked to the “global” cursor position, and
you can move the cursor independently (in this view) from where it is in
the other views.</p>
<p>Close the lightbox view for now (click on the small red circle or X
at the very top of the view).</p>
</div>
</section><section id="viewing-multiple-images"><h2 class="section-heading">Viewing multiple images<a class="anchor" aria-label="anchor" href="#viewing-multiple-images"></a>
</h2>
<hr class="half-width">
<p>Now load in a second image
(<code>sub-OAS30015_T1w_brain_pve_0.nii.gz</code>) using <em>File &gt;
Add from file</em>. This image is a tissue segmentation image of the
cerebrospinal fluid. In the bottom-left panel is a list of loaded images
- the <em>overlay list</em>. <img src="fig/overlay_list_oasis.png" alt="Overlay list" height="150" class="figure"></p>
<p>The overlay list shows the images which are currently loaded into
FSLeyes. When you select an image in this list, it becomes the
<strong>currently selected</strong> image - in FSLeyes, you can only
select one image at a time.</p>
<p>You can use the controls on the display toolbar to adjust the display
properties of the currently selected image. Select the image you just
loaded (<code>sub-OAS30015_T1w_brain_pve_0.nii.gz</code>), and use the
display toolbar to change its colour map to <em>Red-yellow</em>.</p>
<p>The overlay list allows you to do the following:</p>
<ul>
<li>Change the currently selected overlay, by clicking on the overlay
name.</li>
<li>Identify the currently selected overlay (highlighted in blue).</li>
<li>Add/remove overlays with the + and - buttons.</li>
<li>Change the overlay display order with the ▲ and ▼ buttons.</li>
<li>Show/hide each overlay with the eye button ( <img src="fig/eye_icon.png" class="figure"> {alt=“eye icon” height=‘24px’} ), or by double
clicking on the overlay name.</li>
<li>Link overlay display properties with the chainlink button ( <img src="fig/chainlink_icon.png" alt="chain icon" height="24" class="figure"> ).</li>
<li>Save an overlay if it has been edited, with the floppy disk button (
<img src="fig/floppy_disk_icon.png" alt="disk icon" height="24" class="figure">
).</li>
<li>Left-click and hold the mouse button down on the overlay name to
view the overlay source (e.g. its location in the file system).</li>
</ul></section><section id="image-information"><h2 class="section-heading">Image information<a class="anchor" aria-label="anchor" href="#image-information"></a>
</h2>
<hr class="half-width">
<p>In the bottom right corner of the FSLeyes window you will find the
location panel, which contains information about the current cursor
location, and image data values at that location. <img src="fig/location_panel_oasis.png" alt="Location panel" height="140" class="figure"></p>
<p>The controls on the left show the cursor location in <strong>world
coordinates</strong> (millimetres). This coordinate system will change
depending upon whether your image is in native subject space (scanner
anatomical coordinates), standard template coordinates (e.g. MNI152), or
some other coordinate space.</p>
<p>The controls in the middle show the cursor location in <strong>voxel
coordinates</strong>, relative to the currently selected image. If the
currently selected image is 4D (e.g. a time series image), the bottom
control displays the currently selected volume (e.g. time point).</p>
<p>The area on the right displays the intensity value and voxel location
at the current cursor location for all loaded images. Note that if you
have images with different resolutions loaded, the voxel location will
be different for each of them.</p>
</section><section id="viewing-atlases"><h2 class="section-heading">Viewing Atlases<a class="anchor" aria-label="anchor" href="#viewing-atlases"></a>
</h2>
<hr class="half-width">
<p>It is often useful to look at images in standard space. This means
that images are aligned (<em>registered</em>) to a reference template so
that each coordinate corresponds to the same point in the brain in all
images. This allows to perform group level analyses.</p>
<p>Let’s have a look at one of the most used templates, the MNI152.
Unload all the images from <code>fsleyes</code> clicking on the minus
(<code>-</code>) icon in the Overlay list panel (or open a new instance
if you closed it before), press <em>File &gt; Add standard</em> and
select the image <code>MNI152_T1_1mm</code>. As you can see it looks
very similar to the T1w image we looked at earlier. This is basically an
<em>average T1w</em>.</p>
<p>Because we are in standard space, we can turn on the atlas tools with
<em>Settings &gt; Ortho View 1 &gt; Atlases</em>. Now as you click
around in the image you can see reporting of the probability of being in
different brain structures. You might want to resize the different
FSLeyes panels to increase the size of the Atlas information space (in
general you do this by dragging around the edges of the different
FSLeyes panels).</p>
<p>The atlas panel is organized into three main sections - <em>Atlas
information</em>, <em>Atlas search</em>, and <em>Atlas management</em>.
These sections are accessed by clicking on the tabs at the top of the
panel. We will only cover the first two sections in this introductory
practical.</p>
<div class="section level3">
<h3 id="atlas-information">Atlas information<a class="anchor" aria-label="anchor" href="#atlas-information"></a>
</h3>
<p>The <strong>Atlas information</strong> tab displays information about
the current display location, relative to one or more atlases: <img src="fig/atlas_info_panel.png" alt="Atlas information panel" height="200" class="figure"> The list on the left allows you to select the atlases
that you wish to query - click the check boxes to the left of an atlas
to toggle information on and off for that atlas. The Harvard-Oxford
cortical and sub-cortical structural atlases are both selected by
default. These are formed by averaging careful hand segmentations of
structural images of many separate individuals.</p>
<p>The panel on the right displays information about the current display
location from each selected atlas. For probabilistic atlases, the
region(s) corresponding to the display location are listed, along with
their probabilities. For discrete atlases, the region at the current
location is listed.</p>
<p>You may click on the <strong>Show/Hide</strong> links alongside each
atlas and region name to toggle corresponding atlas images on and
off.</p>
</div>
<div class="section level3">
<h3 id="atlas-search">Atlas search<a class="anchor" aria-label="anchor" href="#atlas-search"></a>
</h3>
<p>The <strong>Atlas search</strong> tab allows you to browse through
the atlases, and search for specific regions. <img src="fig/atlas_search_panel.png" alt="Atlas search panel" height="200" class="figure"></p>
<p>The list on the left displays all available atlases - the checkbox to
the left of each atlas toggles an image for that atlas on and off.</p>
<p>When you select an atlas in this list, all of the regions in that
atlas are listed in the area to the right. Again, the checkbox to the
left of each region name toggles an image for that region on and off.
The + button next to each region moves the display location to the
(approximate) centre of that region.</p>
<p>The search field at the top of the region list allows you to filter
the regions that are displayed. <img src="fig/atlas_region_search.png" alt="Atlas region search" height="200" class="figure"></p>
<p>When you type some characters into the search field, the region list
will be filtered, so that only those regions with a name that contains
the characters you entered are displayed. The atlas list on the left
will also be updated so that any atlases which contain regions matching
the search term are highlighted in <strong>bold</strong>.</p>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#discussion1"></a>
</h3>
<div class="callout-content">
<p>Use the atlas search feature to locate the thalamus (left or
right).</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>TODO: Add example screenshots here</p>
</div>
</div>
</div>
</div>
<p>For more information about the atlases available please refer to the
<a href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/Atlases" class="external-link">FSL
Wiki</a>.</p>
<p>Quit FSLeyes when you have finished looking at the atlases.</p>
<div id="bonus-exercise-viewing-different-imaging-modalities" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="bonus-exercise-viewing-different-imaging-modalities" class="callout-inner">
<h3 class="callout-title">BONUS EXERCISE: Viewing different imaging modalities<a class="anchor" aria-label="anchor" href="#bonus-exercise-viewing-different-imaging-modalities"></a>
</h3>
<div class="callout-content">
<p>So far we have seen examples of MRI T1-weighted scans (T1w). In
research as well as in clinical setting, we acquire multiple imaging
modalities from the same individual to look at different brain
characteristics. Even if we acquire all the modalities in the same
session, the images may differ in orientation and resolution.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="bu">cd</span> ~/data/ExtraStructuralMRI</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">ls</span></span></code></pre>
</div>
<p>Let’s take two imaging modalities from a different participant:
<code>sub-OAS30003_T1w.nii.gz</code> and
<code>sub-OAS30003_FLAIR.nii.gz</code></p>
<ul>
<li><em>Do they have the same dimension?</em></li>
<li><em>Do they have the same resolution?</em></li>
</ul>
<p>[Hint: use <code>fslhd</code> to answer]</p>
<p>Now let’s have a look at them in FSLeyes:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">fsleyes</span> sub-OAS30003_T1w.nii.gz sub-OAS30003_FLAIR.nii.gz</span></code></pre>
</div>
<p>Change the intensity range for both images to be between 0 and 1000.
Show/hide images with the eye button ( <img src="fig/eye_icon.png" class="figure">
{alt=“eye icon” height=‘24px’} ), or by double clicking on the image
name in the overlay list.</p>
<ul>
<li>
<em>Do they have the same orientation?</em> [Hint: look at the
location panel]</li>
<li><em>Which brain characteristics are more visible in the T1w and
which are more visible on FLAIR?</em></li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>TODO: Add example screenshots here</p>
</div>
</div>
</div>
</div>
<p>In the <a href="structural-mri.html">next episode on structural
MRI</a>, we will learn how to align (register) the two images together
to be able to look at the same point in the brain in both images.</p>
</div>
</section><section id="additional-material"><h2 class="section-heading">Additional material<a class="anchor" aria-label="anchor" href="#additional-material"></a>
</h2>
<hr class="half-width">
<p>For a more extensive tutorial on FSLeyes features, please refer to
the <a href="https://open.win.ox.ac.uk/pages/fslcourse/practicals/intro1/index.html" class="external-link">FSL
course - FSLeyes practical</a></p>
<p>FSLeyes manual: <a href="https://open.win.ox.ac.uk/pages/fsl/fsleyes/fsleyes/userdoc/index.html" class="external-link uri">https://open.win.ox.ac.uk/pages/fsl/fsleyes/fsleyes/userdoc/index.html</a></p>
</section><section id="references"><h2 class="section-heading">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<hr class="half-width">
<ul>
<li>FSL course material: <a href="https://open.win.ox.ac.uk/pages/fslcourse/website/online_materials.html" class="external-link uri">https://open.win.ox.ac.uk/pages/fslcourse/website/online_materials.html</a>
</li>
<li>McCarthy, Paul. (2021). FSLeyes (1.2.0). Zenodo. <a href="https://doi.org/10.5281/zenodo.5504114" class="external-link uri">https://doi.org/10.5281/zenodo.5504114</a>
</li>
<li>Michael Joseph, Jerrold Jeyachandra, and Erin Dickie (eds): “Data
Carpentry: Introduction to MRI Data Analysis.” Version 2019.11, November
2019, <a href="https://carpentries-incubator.github.io/SDC-BIDS-IntroMRI/open-mri-datasets/index.html" class="external-link">https://github.com/carpentries-incubator/SDC-BIDS-IntroMRI</a>
</li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Images are sheets or cubes of numbers.</li>
<li>Medical image datais typically storedin DICOM or Nifti format.</li>
<li>An affine transformation maps the voxel location to real-world
coordinates.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-structural-mri"><p>Content from <a href="structural-mri.html">Structural MRI: Bias Correction, Segmentation and Image Registration</a></p>
<hr>
<p>Last updated on 2024-06-05 |
        
        <a href="https://github.com/HealthBioscienceIDEAS/aaic2024-neuroimaging-workshop/edit/main/episodes/structural-mri.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I process and quantify structural MRI scans?</li>
<li>How do I register MRI with other modalities?</li>
<li>How do I get key metrics out?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Perform basic pre-processing steps, such as bias correction and
tissue segmentation</li>
<li>Assess some common imaging artefacts in the sturctura MRI</li>
<li>Discover how to align and quantify neuroimaging data at regional
level</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="introduction"><h2 class="section-heading">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>In this section, you will be learning how to process and quantify
structural MRI scans. T1-weighted structural MRI scans are the
“workhorse” scan of dementia research. They provide high-resolution,
detailed pictures of a patient’s anatomy, allowing researchers to
visualize where atrophy caused by Alzheimer’s disease or other dementias
is occurring. In addition, it provides anatomical reference to other
imaging modalities, such as functional MRI and positron emission
tomography (PET), that provide lower-resolution maps of brain function
and pathology, so that regional quantification of key areas can be
assessed in these scans.</p>
<p>We will be using two widely used software packages: <a href="https://www.fil.ion.ucl.ac.uk/spm/" class="external-link">SPM</a> and <a href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki" class="external-link">FSL</a>. These packages
provide analysis and visualization functionality of structural and
functional neuroimaging data, and they can be used in both
cross-sectional and longitudinal studies. The subsequent outputs from
these pipelines can be used in the quantification of other imaging
modalities.</p>
<p>After the course, you will be able to perform basic measurements
relevant to dementia research from structural MRI brain scans.</p>
<p>We will use the SPM and FSL tools to perform: * image visualization
of analysis outputs, * intensity inhomogeneity correction, * structural
MRI segmentation, * quantification of volumetric outputs, and *
registration to a standard space atlas.</p>
</section><section id="opening-up-an-image"><h2 class="section-heading">Opening up an image<a class="anchor" aria-label="anchor" href="#opening-up-an-image"></a>
</h2>
<hr class="half-width">
<p>We are going to be working in the <code>StructuralMRI</code>
subfolder under <code>data</code> in your home directory.From the
previous lesson, you learned how to view and navigate images.</p>
<p>Clicking on the Applications in the upper left-hand corner and select
the terminal icon. This will open a terminal window that you will use to
type commands <img src="fig/aic_smri_launch_terminal.png" alt="Launch the terminal" class="figure"></p>
<p>From the terminal window, type <code>fsleyes</code> to open up the
image and have a look around. <img src="fig/aic_smri_fsleyes.png" alt="Open FSL eyes" class="figure"></p>
<p>Now we choose the file <code>sub-OAS_30003_T1w.nii</code> by going to
the File menu and choosing the Add Image command <img src="fig/aic_smri_fsleyes_addfile.png" alt="Add file" class="figure"><img src="fig/aic_smri_fsleyes_choosefile.png" alt="Choose File" class="figure"></p>
<div id="exercise-1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="exercise-1" class="callout-inner">
<h3 class="callout-title">Exercise 1<a class="anchor" aria-label="anchor" href="#exercise-1"></a>
</h3>
<div class="callout-content">
<p>Close fsleyes and then re-open the viewer. This time use the other
image in the folder <code>sub-OAS30217_T1w.nii</code>.</p>
<p><em>What differences do you notice?</em></p>
</div>
</div>
</div>
</section><section id="run-bias-correction-and-tissue-segmentation"><h2 class="section-heading">Run Bias Correction and Tissue Segmentation<a class="anchor" aria-label="anchor" href="#run-bias-correction-and-tissue-segmentation"></a>
</h2>
<hr class="half-width">
<p>Small variations in the magnetic field can result in changes in the
image intensity that vary slowly spatially. These variations are not due
to anatomical differences. We can visually identify this <em>image
inhomogeneity</em> in the white matter, where voxels in one part of the
brain might be so affected by it that they have similar intensity values
as grey matter voxels in other brain regions. However, the intensities
in the white matter voxels should be more or less uniform throughout the
brain. Any remaining inhomogeneity in the image can significantly
influence the results of automated image processing techniques, so we
need to correct for these effects. The process that removes this image
inhomogeneity is typically referred to as <em>bias correction</em>.</p>
<p>The next step is to reliably identify what type of tissue each voxel
contains. While the resolution of structural MRI is quite high
(typically around 1 mm), there is still the likelihood that a voxel will
contain more than one tissue in it. The process of <em>tissue
segmentation</em> looks at the voxel intensity, compares it to its
neighbours and prior information about what tissues we would expect to
have in that voxel and assigns a probability that the voxel contains
that tissue. It typically generates <em>n</em> different volumes, where
<em>n</em> is the number of tissue types you want to use to classify the
brain. We typically focus on three tissue probability maps in
particular: * Grey matter (GM), * White matter (WM), and * Cerebrospinal
fluid (CSF)</p>
<p>SPM performs the <em>bias correction</em> and <em>tissue
segmentation</em> steps simultaneously. Follow the steps below to obtain
bias-corrected images and tissue probability maps.</p>
<div class="section level3">
<h3 id="bias-correction-and-segmenation-steps">Bias Correction and Segmenation Steps<a class="anchor" aria-label="anchor" href="#bias-correction-and-segmenation-steps"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Type <code>spm pet</code> to launch SPM (screenshot) <img src="fig/aic_smri_terminal_window.png" alt="Launch SPM" class="figure">
</li>
<li>SPM will then create a number of windows. You want to look at the
Main Menu Window that has all of the buttons. <img src="fig/aic_smri_spm.png" alt="SPM windows" class="figure">
</li>
<li>From main menu, select the Segment button (Screenshots). This will
launch a window known as the <em>batch editor</em>, where you can adjust
settings on the pipeline to be run. <img src="fig/aic_smri_seg_batch.png" alt="SPM Batch editor" class="figure">
</li>
<li>Edit the options for segmentation:
<ol style="list-style-type: decimal">
<li>Under Data-&gt;Channels-&gt;Volume, click on “Specify…”. <img src="fig/aic_smri_seg_volumes.png" alt="Specify volumes" class="figure">
</li>
<li>In the dialog box that opens up, please navigate to the folder
<code>data</code> and then <code>StructuralMRI</code>. Then select the
first image <code>sub-OAS30003_T1w.nii</code>. Once you click on it, you
will notice the file move down to the bottom of the box which represents
the list of selected files. <img src="fig/aic_smri_seg_chooset1.png" alt="Choose T1 image" class="figure">
</li>
<li>Click the Done button</li>
<li>Back in the batch editor, under Data-&gt;Save Bias Corrected, please
choose “Save Field and Corrected” ![Saving bias field and corrected
images] (fig/aic_smri_seg_bcoption.png){alt=“Choose bias correction
option”}</li>
<li>Under the Tissues section, please make sure that the first three
tissue types, which represent GM, WM, and CSF, have the native tissue
subfield set to native, while the final three tissue types (4-6), which
represent non-brain structures, have the native tissue subfield set to
None. ![Only saving input from first three tissues]
(fig/aic_smri_seg_native.png){alt=“Native segmentation”}</li>
</ol>
</li>
<li>Click the green run button to start! It should take about 5-10
minutes. You will see a lot of other things happening in other windows.
The terminal will say <code>Done - Segment</code> when it has
finished.</li>
</ol>
</div>
</section><section id="quality-check"><h2 class="section-heading">Quality check<a class="anchor" aria-label="anchor" href="#quality-check"></a>
</h2>
<hr class="half-width">
<p>The quality check is an important part of any analysis. We are going
to visualize the outputs from SPM Segment and make sure that the bias
correction and segmentation have worked.</p>
<div class="section level3">
<h3 id="bias-correction">Bias correction<a class="anchor" aria-label="anchor" href="#bias-correction"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Use <code>fsleyes</code> again and open up the original image
<code>sub-OAS30003_T1w.nii</code> as you did at the start of the
session.</li>
<li>Change the image lookup table to <code>NIH</code> <img src="fig/aic_smri_fsleyes_selectnih.png" alt="FSL eyes with NIH colormap" class="figure">
</li>
<li>Then change the image minimum to 40 and the maximum to 600. This
means that all intensities 40 and below will map to the first color in
the lookup table, and all voxels 600 and above will map to the last
color. The white matter should be yellow to red. <img src="fig/aic_smri_fsleyes_minmax.png" alt="Change min and max intensity" class="figure"><br>
</li>
<li>Next add the bias corrected image, which is called
<code>msub-OAS30003_T1w.nii</code>. Change the lookup table to NIH as
you did in Step 2. Change the minimum to 40 and maximum intensity to 500
similar to what you did in Step 2 and 3. <img src="fig/aic_smri_fsleyes_biasnih.png" alt="Bias in image using NIH map" class="figure">
</li>
</ol>
<p>When you add this image, it will overlay on top of the original
image. Think of this new image a completely opaque, so that you no
longer see the original one. If you want to see the original one, then
you need to either turn it off using the eye icon right by the file, or
you need to turn the opacity (slider near the top of the screen which is
marked opacity.)</p>
<div id="exercise-2" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="exercise-2" class="callout-inner">
<h3 class="callout-title">Exercise 2<a class="anchor" aria-label="anchor" href="#exercise-2"></a>
</h3>
<div class="callout-content">
<p>Use the eye icon in the overlay list right next to the file
<code>msub-OAS30003_T1w.nii</code> and turn this image off and on many
times. This will allow you to compare with the original image.</p>
<p><em>What do you notice about the image in the white matter area when
comparing the bias correct and original image?</em></p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="tissue-segmentation">Tissue segmentation<a class="anchor" aria-label="anchor" href="#tissue-segmentation"></a>
</h3>
<p>Now that we are happy with the bias correction, lets look at the
tissue segmentation. 1. Use the icon to turn off the original image.
Select the bias corrected image and make sure the colormap is back to
the first option “Greyscale” <img src="fig/aic_smri_fsleyes_orig.png" alt="Bias correted image in greyscale" class="figure"> 1. Now add the grey matter
probability image <code>c1sub-OAS30003_T1w.nii</code>. 1. Choose the
probability map and set the lookup table to Red. Change the minimum
intensity to 0.2 and the maximum intensity to 0.9. This will eliminate
some noise from very low probability voxels. 1. Use the opacity slider
to make the grey matter probability map transparent. <img src="fig/aic_smri_fsleyes_gm.png" alt="Looking at grey matter image" class="figure">
1. Look around the image, zoom in places, and try turning the grey
matter probability map off and on. The goal is to make sure the grey
matter probability map is not: 1. Missing any grey matter 1. Not
including other tissue (WM, CSF, non-brain tissue that has a similar
intensity to GM)</p>
<div id="exercise-3" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="exercise-3" class="callout-inner">
<h3 class="callout-title">Exercise 3<a class="anchor" aria-label="anchor" href="#exercise-3"></a>
</h3>
<div class="callout-content">
<p>Now do the same steps with the white matter image
<code>c2sub-OAS30003_T1w.nii</code> and the cerebrospinal fluid image
<code>c3sub-OAS30003_T1w.nii</code>. Choose different color
colormaps.</p>
<p><em>Do these images look like they have identified the white matter
and CSF in the T1 weighted image correctly?</em></p>
</div>
</div>
</div>
</div>
</section><section id="obtaining-volume"><h2 class="section-heading">Obtaining volume<a class="anchor" aria-label="anchor" href="#obtaining-volume"></a>
</h2>
<hr class="half-width">
<p>One thing that we are often interested in is to obtain the actual
volume of grey matter, or a particular brain region. There are helpful
utilities in FSL to extract the volume from the tissue probability maps.
First we will change our working directory to the Structural MRI
folder:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="bu">cd</span> ~/data/StructuralMRI</span></code></pre>
</div>
<p>Then we will run this command to get the total grey matter
volume:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">fslstats</span> c1sub-OAS30003_T1w.nii <span class="at">-V</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Produce output for this command</code></pre>
</div>
<p>This will produce two numbers. The first number is the number of
voxels in the grey matter. These voxels as discussed earlier have
physical dimensions indicating how the volume that each individual voxel
represents. So the second value indicates the total volume of the grey
matter (usually represented in units of cubic millimeters).</p>
</section><section id="coregistration-to-standard-space"><h2 class="section-heading">Coregistration to standard space<a class="anchor" aria-label="anchor" href="#coregistration-to-standard-space"></a>
</h2>
<hr class="half-width">
<p>MRI scans can be acquired in any orientation. Even when we think we
are getting a sagittal or coronal acquisition, the patient may end up in
the scanner at a slant. This makes it difficult to identify key
anatomical landmarks. We may also want to compare common anatomical
structures across a whole sample of subjects. The main solution to this
is to use <em>image registration</em> to orient our images and align
them with a standard anatomical coordinate system. In this case, we will
be aligning our data to the Montreal Neurological Institute <a href="https://mcin.ca/research/neuroimaging-methods/atlases/" class="external-link">MNI152
atlas</a>. We are not looking to perform an exact voxel to voxel match
between our image and the atlas. Instead, we just want to align the
images such that the orientation and the relative size are aligned.</p>
<div class="section level3">
<h3 id="skull-stripping">Skull stripping<a class="anchor" aria-label="anchor" href="#skull-stripping"></a>
</h3>
<p>Before we can perform the registration, we will use the tissue
probability maps to <em>skull strip</em> the image. Skull stripping
removes the non-brain tissue (scalp, dura, neck, eyes, etc) from the
image. Before we run the commands, let’s first check what working
directory we are in by using the command <code>pwd</code>:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="bu">pwd</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Produce correct output for pwd</code></pre>
</div>
<p>If you have a different output from the above, then run the following
command:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="bu">cd</span> ~/data/StructuralMRI</span></code></pre>
</div>
<p>First we will use the FSL utility <code>fslmaths</code> to create a
brain mask by using the tissue probability maps from SPM.
<code>fslmaths</code> is a great swiss-army knife utility to do lots of
helpful little image processing bits.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">fslmaths</span> c1sub-OAS30003_T1w.nii <span class="at">-add</span> c2sub-OAS30003_T1w.nii <span class="at">-add</span> c3sub-OAS30003_T1w.nii <span class="at">-thr</span> 0.5 <span class="at">-bin</span> sub-OAS30003_T1w_brain_mask.nii</span></code></pre>
</div>
<p>Let’s break this command down a little bit:</p>
<ul>
<li>First, we state the command we want to run
<code>fslmaths</code>
</li>
<li>We then specify our input image, the GM map
<code>c1sub-OAS30003_T1w.nii</code>
</li>
<li>We then specify the first operation <code>-add</code>
</li>
<li>We then specify what we want to add to our input image. In this
case, it is the WM map <code>c2sub-OAS30003_T1w.nii</code>. The
resulting image would contain the probability that a voxel is either GM
or WM.</li>
<li>We then specify that we want to add another image, and this time it
is the CSF map. This image now holds the probability that a voxel is GM,
WM, or CSF, which are the three main tissue types in the brain that we
want to process.</li>
<li>We will then threshold this image at 0.5 using the
<code>-thr 0.5</code> option. This says to only keep voxels who have a
probability of 0.5 or greater. All other voxels are set to 0.</li>
<li>Our final operation is to <em>binarize</em> the image. Any values
that are not zero are set to one. This creates a mask which says whether
the voxel is inside (<strong>1</strong>) or outside (<strong>0</strong>)
of the brain.<br>
</li>
<li>Finally, we save our results into the new image file
<code>sub-OAS30003_T1w_brain_mask.nii</code>
</li>
</ul>
<p>Now that we have created a mask, we are going to remove all the
information outside of the mask using the following command:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">fslmaths</span> msub-OAS30003_T1w.nii <span class="at">-mas</span> sub-OAS30003_T1w_brain_mask.nii.gz msub-OAS30003_T1w_brain.nii</span></code></pre>
</div>
<p>This command masks our bias corrected image with the brain mask and
makes a new file which has the name
<code>msub-OAS30003_T1w_brain.nii</code>. Take a look at the image in
<code>fsleyes</code>. <img src="fig/aic_smri_fsleyes_skullstripped.png" alt="Skull stripped image" class="figure"></p>
<p>We will then use the FSL registration program <a href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FLIRT" class="external-link">FLIRT</a> to align
our image to the standard space MNI152. Please follow the steps below:
1. On the terminal window, please type in the following command
<code>Flirt</code> 1. This will open a dialog box. We will change the
following settings: 1. For reference image, click on the folder icon and
choose the image <code>MNI152_T1_1mm_brain</code> 1. For the input
image, please select the mask we created above
<code>msub-OAS30003_T1w_brain.nii</code> 1. For the output image, please
type in a new name <code>msub-OAS30003_T1w_brain_MNI.nii</code> The
final command setup should look like the screenshot below. <img src="fig/aic_smri_flirt.png" alt="FLIRT window" class="figure"></p>
<p>If your window looks like this, then click the <strong>Go</strong>
button at the bottom, in the terminal, you will see the <em>command
line</em> program that would run what you have set up in the dialog box.
If you were to select that command and run it in the terminal it would
do the same thing.</p>
</div>
<div class="section level3">
<h3 id="quality-check-1">Quality check<a class="anchor" aria-label="anchor" href="#quality-check-1"></a>
</h3>
<p>Let’s open <code>fsleyes</code> and open the output from the
co-registration <code>msub-OAS30003_T1w_brain_MNI.nii</code>. <img src="fig/aic_smri_fsleyes_mnispace.png" alt="T1w in MNI space" class="figure"></p>
<p>Now click on the Add Standard function. This is where fsleyes keeps
all of the standard atlases and templates so that you can quickly access
them. <img src="fig/aic_smri_fsleyes_addstd.png" alt="Add standard function" class="figure"></p>
<p>Select the <code>MNI152_T1_1mm_brain</code> from this list of files.
<img src="fig/aic_smri_fsleyes_choosemni.png" alt="Choose MNI image" class="figure"></p>
<p>We can now check if our image is registered by flicking back and
forth between the MNI image and our image.</p>
</div>
</section><section id="stretch-exercises"><h2 class="section-heading">Stretch exercises<a class="anchor" aria-label="anchor" href="#stretch-exercises"></a>
</h2>
<hr class="half-width">
<p>If you have completed all of the above and want to keep working on
more structural imaging data, please try the exercises below.</p>
<div id="bonus-exercise-1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="bonus-exercise-1" class="callout-inner">
<h3 class="callout-title">BONUS Exercise 1<a class="anchor" aria-label="anchor" href="#bonus-exercise-1"></a>
</h3>
<div class="callout-content">
<p>Extract the volumes from the WM and CSF probability maps for
<code>sub-OAS30003_T1w.nii</code>.</p>
<p><em>What are the three tissue volumes?</em></p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>TODO: add the solution of the three tissue volumes</p>
</div>
</div>
</div>
</div>
<div id="bonus-exercise-2" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="bonus-exercise-2" class="callout-inner">
<h3 class="callout-title">BONUS Exercise 2<a class="anchor" aria-label="anchor" href="#bonus-exercise-2"></a>
</h3>
<div class="callout-content">
<p>The volumes that come out of <code>fslstats</code> assume that each
voxel is completely full of GM, even though for some voxels the
probability may be very small. That can lead to inaccuracies, so there
are a couple of ways we can more accurately measure from tissue
probability maps.</p>
<p>Before we start, let’s make sure we are in the right working
directory by using the <code>cd</code> command.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="bu">cd</span> ~/data/StructuralMRI</span></code></pre>
</div>
<p>The first approach is to only count voxels with a
<strong>majority</strong> of GM. So we will threshold by the value of
0.5 before calculating our volume.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">fslstats</span> c1sub-OAS30003_T1w.nii <span class="at">-l</span> 0.5 <span class="at">-V</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>TODO: Output of fslstats</code></pre>
</div>
<p>The second approach is to get the mean and volume of the all the
non-zero voxels.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">fslstats</span> c1sub-OAS30003_T1w.nii <span class="at">-M</span> <span class="at">-V</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>TODO: Output of fslstats</code></pre>
</div>
<p>This will produce three numbers: 1. The mean of the non-zero voxels
2. The number of voxels greater than zero. 3. The volume of the voxels
greater than zero.</p>
<p>If you multiply (1) by (3), this would be what we call the
<em>probabilistic</em> volume of the GM and it accurately accounts the
amount of GM in each voxel.</p>
<p><em>How do these volumes compare with the original volume you
obtained?</em></p>
</div>
</div>
</div>
<div id="bonus-exercise-3" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="bonus-exercise-3" class="callout-inner">
<h3 class="callout-title">BONUS Exercise 3<a class="anchor" aria-label="anchor" href="#bonus-exercise-3"></a>
</h3>
<div class="callout-content">
<p>Let’s take a look at our other image
<code>sub-OAS30217_T1w.nii</code>. Perform the same steps as you did for
the first image: * Segmentation * Skull Stripping * Co-registration to
standard space Run the same skull stripping and registration as you have
done before. Now open up both standard space images in
<code>fsleyes</code></p>
<p><em>What do you observe about the images?</em></p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>TODO: Provide solution</p>
</div>
</div>
</div>
</div>
<div id="bonus-exercise-4" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="bonus-exercise-4" class="callout-inner">
<h3 class="callout-title">BONUS Exercise 4<a class="anchor" aria-label="anchor" href="#bonus-exercise-4"></a>
</h3>
<div class="callout-content">
<p>Let’s now try to co-register two imaging modalities from one
participant (<em>within-subject registration</em>)</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="bu">cd</span> ~/data/ExtraStructuralMRI</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">ls</span></span></code></pre>
</div>
<p>At the end of the previous session on data visualization, you looked
at a T1-weighted scan and a FLAIR scan from the same participant
(<code>sub-OAS30003_T1w.nii.gz</code> and
<code>sub-OAS30003_FLAIR.nii.gz</code>, load them again in FSLeyes if
you need a refresh). As you will have noticed, they have different
dimensions, resolution and orientation, so if we want to look at the
same point in the brain in both images we need to align them.</p>
<p>First, we need to choose which image we want to keep unchanged
(<em>reference</em>) and which one we want to align to the reference
(<em>input</em>). Let’s assume we want to register the FLAIR image to
the T1. We have already prepared a skull-stripped version of the images
for you so they are ready to be aligned with <a href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FLIRT" class="external-link">FLIRT</a>.</p>
<p>The way to do this is very similar to what you did before to
co-register a T1 to standard space. Please follow the steps below: 1. On
the terminal window, type <code>Flirt</code> 1. This will open the
dialog box you used before. The new settings are: 1. For reference
image, delete the text in the box and type
<code>~/data/ExtraStructuralMRI</code>, then click on the folder icon
and choose the image <code>sub-OAS30003_T1w_brain.nii.gz</code> 1.
Change the Model/DOF (input to ref) to
<code>Rigid Body (6 parameter model)</code> 1. For the input image,
click on the folder icon and choose the image
<code>sub-OAS30003_FLAIR_brain.nii.gz</code> 1. For the output image,
please type in a new name
<code>sub-OAS30003_FLAIR_to_T1w.nii.gz</code></p>
<p>The final command setup should look like the screenshot below: <img src="fig/aic_smri_flirt_T1FLAIR.png" alt="Coregistration of T1 and FLAIR" class="figure"></p>
<p>If your window looks like this, then click the <strong>Go</strong>
button at the bottom, in the terminal, you will see the <em>command
line</em> program that would run what you have set up in the dialog box.
If you were to select that command and run it in the terminal it would
do the same thing.</p>
<p>Once done, open the result in FSLeyes:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">fsleyes</span> sub-OAS30003_T1w_brain.nii.gz sub-OAS30003_FLAIR_to_T1w.nii.gz <span class="kw">&amp;</span></span></code></pre>
</div>
<p>We can now check if our image is registered by flicking back and
forth between the T1 image and the FLAIR registered image.</p>
<p><em>Can you think of why the registered FLAIR image appears blurred
in the sagittal and coronal plane?</em></p>
<p>Now try to do the opposite: co-register the T1 to the FLAIR.</p>
<p><em>What differences do you notice with respect to the previous case
(FLAIR co-registered to T1)?</em></p>
<p><em>Can you think of different cases where you would want to use T1
or FLAIR as your reference?</em></p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>TODO: add key points to solution</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Structural MRI provides high-resolution anatomic information for
neuroimaging analysis</li>
<li>Bias correction removes image inhomogeneities</li>
<li>Tissue segmentation identifies key tissue types (grey matter, white
matter, cerebrospinal fluid) from T1 weighted images</li>
<li>Co-registration of MRI to other modalities can be used to analyse
these images at a regional level.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/HealthBioscienceIDEAS/aaic2024-neuroimaging-workshop/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/HealthBioscienceIDEAS/aaic2024-neuroimaging-workshop/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/HealthBioscienceIDEAS/aaic2024-neuroimaging-workshop/" class="external-link">Source</a></p>
				<p><a href="https://github.com/HealthBioscienceIDEAS/aaic2024-neuroimaging-workshop/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:d.cash@ucl.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/HealthBioscienceIDEAS/sandpaper/tree/IDEAS" class="external-link">sandpaper (0.16.5.9000)</a>, <a href="https://github.com/carpentries/pegboard/tree/a32a7836d4455f407c3cafe8ab95edc636e5e919" class="external-link">pegboard (0.7.5)</a>, and <a href="https://github.com/HealthBioscienceIDEAS/varnish/tree/IDEAS" class="external-link">varnish (1.0.3.9000)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://HealthBioscienceIDEAS.github.io/aaic2024-neuroimaging-workshop/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "medical imaging, MRI, visualization, PET, Alzheimers disease",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://HealthBioscienceIDEAS.github.io/aaic2024-neuroimaging-workshop/aio.html",
  "identifier": "https://HealthBioscienceIDEAS.github.io/aaic2024-neuroimaging-workshop/aio.html",
  "dateCreated": "2024-06-04",
  "dateModified": "2024-06-05",
  "datePublished": "2024-06-05"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

